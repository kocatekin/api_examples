<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3pro.css">
</head>
    <body>

        <div id="mydiv">
            <div id="altin">
                Altın: <br> Alış: <span id="gold-buy"></span>, Satış: <span id="gold-sell"></span>
            </div>
            <div id="gumus">
                Gümüş: <br> Alış: <span id="silver-buy"></span>, Satış: <span id="silver-sell"></span>
            </div>
        </div>
                   
    </body>
    <script>
   
        const apiURL = "http://localhost:5000/";

        //array so we can keep tack of the rates
        const trackRates = []
        

        async function fetchPost() {
            try{ 
                let res = await fetch(apiURL);
                let data = await res.json();
                
                console.log(data);
                show(data);

            } catch(error) {
                console.error(`error fetching: ${error}`);
            }
        }

        function show(data) {
            let tarih = data["date"];
            let goldBuy = data["gold"]["buy"].replace('.', '').replace(',', '.'); // we are changing the format to ordinary for example from 2.389,72 to 2389.72
            let goldSell = data["gold"]["sell"].replace('.', '').replace(',', '.');
            let silverBuy = data["silver"]["buy"].replace(',', '.'); // we are changing the format to ordinary for example from 25,9032 to 25.9032
            let silverSell = data["silver"]["sell"].replace(',', '.');

            //we only want to store only the latest values of if the values exist we update else we push them into the array
            if (trackRates.length < 4) {
                trackRates.push({ goldBuy, icon: '-' }, { goldSell, icon: '-' }, { silverBuy, icon: '-' }, { silverSell, icon: '-' });
            } else {
                updateRate(0, trackRates[0].goldBuy, goldBuy, "gold-buy", "goldBuy");
                updateRate(1, trackRates[1].goldSell, goldSell, "gold-sell", "golSell");
                updateRate(2, trackRates[2].silverBuy, silverBuy, "silver-buy", "silverBuy");
                updateRate(3, trackRates[3].silverSell, silverSell, "silver-sell", "silverSell");
            }
            console.log(trackRates)

            document.getElementById("gold-buy").innerHTML = `${goldBuy} ${trackRates[0].icon}`;
            document.getElementById("gold-sell").innerHTML = `${goldSell} ${trackRates[1].icon}`;
            document.getElementById("silver-buy").innerHTML = `${silverBuy} ${trackRates[2].icon}`;
            document.getElementById("silver-sell").innerHTML = `${silverSell} ${trackRates[3].icon}`;
            //document.getElementById("altin").innerHTML = `Altın: <br> Alış: ${goldBuy} ${trackRates[0].icon}, Satış: ${goldSell}`;
            //document.getElementById("gumus").innerHTML = `Gümüş: <br> Alış: ${silverBuy} Satış: ${silverSell}`;


        }

        //this function takes 4 arguments
        //rateIndex to access the index of the rate
        //currentValue is the latest value of that particular index
        //newValue is the vlaue we got from the api
        //elemetId is the id of the html tag so we can update the UI
        //target we use that to update the value we want whether its the name of the rate or the icon 
        function updateRate(rateIndex, currentValue, newValue, elementId, target) {
            const icon = parseFloat(currentValue) <= parseFloat(newValue) ? "▲" : "▼"; 
            const color = parseFloat(currentValue) <= parseFloat(newValue) ? "green" : "red";
        
            trackRates[rateIndex][target] = newValue
            trackRates[rateIndex]["icon"] = icon
            document.getElementById(elementId).style.color = color;
        }
        
        
        fetchPost();
        setInterval(fetchPost, 5000);

        //how to see if they increase or decrease? 
        //i need to save the data, and compare it with the incoming data
        //data can be stored in a basic array. later, array elements will be compared and we will see if it is larger or not
        //if larger, green -- if not, red.

            
            

    </script>
</html>
